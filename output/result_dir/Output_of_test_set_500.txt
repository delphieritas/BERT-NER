


yangnan@ncrs:/hdd1/yangnan/bertner$ bash run_ner.sh
WARNING: Logging before flag parsing goes to stderr.
W0715 15:30:33.595113 140270154254080 deprecation_wrapper.py:119] From /hdd1/yangnan/bertner/bert/optimization.py:87: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0715 15:30:33.596499 140270154254080 deprecation_wrapper.py:119] From BERT_NER.py:694: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0715 15:30:33.597069 140270154254080 deprecation_wrapper.py:119] From /hdd1/yangnan/bertner/bert/modeling.py:93: The name tf.gfile.GFile is deprecated. Please use tf.io.gfile.GFile instead.

W0715 15:30:34.479092 140270154254080 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0715 15:30:34.759503 140270154254080 estimator.py:1984] Estimator's model_fn (<function model_fn_builder.<locals>.model_fn at 0x7f9300cac488>) includes params argument, but params are not passed to Estimator.
I0715 15:30:34.760386 140270154254080 estimator.py:209] Using config: {'_model_dir': './output/result_dir', '_tf_random_seed': None, '_save_summary_steps': 100, '_save_checkpoints_steps': 1000, '_save_checkpoints_secs': None, '_session_config': allow_soft_placement: true
graph_options {
  rewrite_options {
    meta_optimizer_iterations: ONE
  }
}
, '_keep_checkpoint_max': 5, '_keep_checkpoint_every_n_hours': 10000, '_log_step_count_steps': None, '_train_distribute': None, '_device_fn': None, '_protocol': None, '_eval_distribute': None, '_experimental_distribute': None, '_experimental_max_worker_delay_secs': None, '_service': None, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f9300b4b940>, '_task_type': 'worker', '_task_id': 0, '_global_id_in_cluster': 0, '_master': '', '_evaluation_master': '', '_is_chief': True, '_num_ps_replicas': 0, '_num_worker_replicas': 1, '_tpu_config': TPUConfig(iterations_per_loop=1000, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=3, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_cluster': None}
I0715 15:30:34.760612 140270154254080 tpu_context.py:209] _TPUContext: eval_on_tpu True
W0715 15:30:34.760803 140270154254080 tpu_context.py:211] eval_on_tpu ignored because use_tpu is False.
W0715 15:30:34.760962 140270154254080 deprecation_wrapper.py:119] From BERT_NER.py:322: The name tf.python_io.TFRecordWriter is deprecated. Please use tf.io.TFRecordWriter instead.

W0715 15:30:41.502445 140270154254080 deprecation_wrapper.py:119] From BERT_NER.py:348: The name tf.FixedLenFeature is deprecated. Please use tf.io.FixedLenFeature instead.

I0715 15:30:41.506859 140270154254080 estimator.py:360] Skipping training since max_steps has already saved.
I0715 15:30:41.506974 140270154254080 error_handling.py:96] training_loop marked as finished
W0715 15:30:43.385543 140270154254080 deprecation.py:323] From BERT_NER.py:372: map_and_batch (from tensorflow.python.data.experimental.ops.batching) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.map(map_func, num_parallel_calls)` followed by `tf.data.Dataset.batch(batch_size, drop_remainder)`. Static tf.data optimizations will take care of using the fused implementation.
W0715 15:30:43.387062 140270154254080 deprecation_wrapper.py:119] From BERT_NER.py:355: The name tf.parse_single_example is deprecated. Please use tf.io.parse_single_example instead.

W0715 15:30:43.390972 140270154254080 deprecation.py:323] From BERT_NER.py:359: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
I0715 15:30:43.407977 140270154254080 estimator.py:1145] Calling model_fn.
I0715 15:30:43.408150 140270154254080 tpu_estimator.py:2965] Running eval on CPU
W0715 15:30:43.411949 140270154254080 deprecation_wrapper.py:119] From /hdd1/yangnan/bertner/bert/modeling.py:171: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0715 15:30:43.413693 140270154254080 deprecation_wrapper.py:119] From /hdd1/yangnan/bertner/bert/modeling.py:409: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0715 15:30:43.451670 140270154254080 deprecation_wrapper.py:119] From /hdd1/yangnan/bertner/bert/modeling.py:490: The name tf.assert_less_equal is deprecated. Please use tf.compat.v1.assert_less_equal instead.

W0715 15:30:43.516526 140270154254080 deprecation.py:323] From /hdd1/yangnan/bertner/bert/modeling.py:671: dense (from tensorflow.python.layers.core) is deprecated and will be removed in a future version.
Instructions for updating:
Use keras.layers.dense instead.
W0715 15:30:45.823614 140270154254080 deprecation.py:506] From /home/yangnan/anaconda3/lib/python3.7/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0715 15:30:45.923719 140270154254080 deprecation.py:323] From /home/yangnan/anaconda3/lib/python3.7/site-packages/tensorflow/contrib/crf/python/ops/crf.py:213: dynamic_rnn (from tensorflow.python.ops.rnn) is deprecated and will be removed in a future version.
Instructions for updating:
Please use `keras.layers.RNN(cell)`, which is equivalent to this API
W0715 15:30:45.979362 140270154254080 deprecation.py:323] From /home/yangnan/anaconda3/lib/python3.7/site-packages/tensorflow/python/ops/math_ops.py:2403: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0715 15:30:46.194644 140270154254080 deprecation_wrapper.py:119] From BERT_NER.py:476: The name tf.train.init_from_checkpoint is deprecated. Please use tf.compat.v1.train.init_from_checkpoint instead.

W0715 15:30:47.451455 140270154254080 deprecation.py:323] From /hdd1/yangnan/bertner/metrics.py:82: to_int64 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
I0715 15:30:47.521707 140270154254080 estimator.py:1147] Done calling model_fn.
I0715 15:30:47.540699 140270154254080 evaluation.py:255] Starting evaluation at 2019-07-15T15:30:47Z
I0715 15:30:48.108119 140270154254080 monitored_session.py:240] Graph was finalized.
2019-07-15 15:30:48.108437: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2019-07-15 15:30:48.115278: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2094960000 Hz
2019-07-15 15:30:48.116056: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x555854696a00 executing computations on platform Host. Devices:
2019-07-15 15:30:48.116105: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
W0715 15:30:48.117058 140270154254080 deprecation.py:323] From /home/yangnan/anaconda3/lib/python3.7/site-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0715 15:30:48.118302 140270154254080 saver.py:1280] Restoring parameters from ./output/result_dir/model.ckpt-871
2019-07-15 15:30:48.399046: W tensorflow/compiler/jit/mark_for_compilation_pass.cc:1412] (One-time warning): Not using XLA:CPU for cluster because envvar TF_XLA_FLAGS=--tf_xla_cpu_global_jit was not set.  If you want XLA:CPU, either set that envvar, or use experimental_jit_scope to enable XLA:CPU.  To confirm that XLA is active, pass --vmodule=xla_compilation_cache=1 (as a proper command-line flag, not via TF_XLA_FLAGS) or set the envvar XLA_FLAGS=--xla_hlo_profile.
2019-07-15 15:30:48.416862: W tensorflow/core/framework/allocator.cc:107] Allocation of 89075712 exceeds 10% of system memory.
I0715 15:30:48.951503 140270154254080 session_manager.py:500] Running local_init_op.
I0715 15:30:49.017350 140270154254080 session_manager.py:502] Done running local_init_op.
I0715 15:34:04.477692 140270154254080 evaluation.py:275] Finished evaluation at 2019-07-15-15:34:04
I0715 15:34:04.479293 140270154254080 estimator.py:2039] Saving dict for global step 871: confusion_matrix = [[0.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00
  0.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00]
 [0.0000e+00 8.3700e+02 6.0000e+00 2.2000e+01 4.0000e+00 0.0000e+00
  1.8000e+01 0.0000e+00 8.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00]
 [0.0000e+00 1.1000e+01 2.7900e+02 1.5000e+01 0.0000e+00 3.0000e+00
  2.0000e+00 6.0000e+00 1.0000e+00 3.0000e+00 4.0000e+00 0.0000e+00]
 [0.0000e+00 3.8000e+01 2.0000e+01 3.9548e+04 7.0000e+00 2.0000e+00
  1.6000e+01 1.8000e+01 1.0000e+01 1.0000e+00 6.2000e+01 0.0000e+00]
 [0.0000e+00 7.0000e+00 0.0000e+00 9.0000e+00 1.4730e+03 5.0000e+00
  5.0000e+00 0.0000e+00 9.0000e+00 1.0000e+00 1.0000e+00 0.0000e+00]
 [0.0000e+00 0.0000e+00 2.0000e+00 5.0000e+00 6.0000e+00 9.7400e+02
  1.0000e+00 5.0000e+00 0.0000e+00 1.0000e+00 0.0000e+00 0.0000e+00]
 [0.0000e+00 1.7000e+01 1.0000e+00 1.1000e+01 1.8000e+01 0.0000e+00
  1.0180e+03 8.0000e+00 1.3000e+01 0.0000e+00 0.0000e+00 0.0000e+00]
 [0.0000e+00 0.0000e+00 9.0000e+00 1.3000e+01 0.0000e+00 0.0000e+00
  5.0000e+00 6.1100e+02 1.0000e+00 4.0000e+00 2.0000e+00 0.0000e+00]
 [0.0000e+00 2.2000e+01 0.0000e+00 7.0000e+00 5.0000e+00 1.0000e+00
  2.1000e+01 1.0000e+00 1.4770e+03 4.0000e+00 1.0000e+00 0.0000e+00]
 [0.0000e+00 0.0000e+00 4.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00
  0.0000e+00 5.0000e+00 0.0000e+00 2.2900e+02 1.0000e+00 0.0000e+00]
 [0.0000e+00 0.0000e+00 0.0000e+00 2.5000e+01 2.0000e+00 2.0000e+00
  2.0000e+00 0.0000e+00 1.0000e+00 0.0000e+00 1.3480e+04 0.0000e+00]
 [0.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00
  0.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00 0.0000e+00 1.7390e+03]], global_step = 871, loss = 1.3746372
I0715 15:34:05.238216 140270154254080 estimator.py:2072] Summary for np.ndarray is not visible in Tensorboard by default. Consider using a Tensorboard plugin for visualization (see https://github.com/tensorflow/tensorboard-plugin-example/blob/master/README.md for more information).
I0715 15:34:05.238748 140270154254080 estimator.py:2099] Saving 'checkpoint_path' summary for global step 871: ./output/result_dir/model.ckpt-871
I0715 15:34:05.239159 140270154254080 error_handling.py:96] evaluation_loop marked as finished
I0715 15:34:05.704942 140270154254080 estimator.py:1145] Calling model_fn.
I0715 15:34:05.705143 140270154254080 tpu_estimator.py:2965] Running infer on CPU
I0715 15:34:09.947877 140270154254080 estimator.py:1147] Done calling model_fn.
I0715 15:34:10.565685 140270154254080 monitored_session.py:240] Graph was finalized.
I0715 15:34:10.567152 140270154254080 saver.py:1280] Restoring parameters from ./output/result_dir/model.ckpt-871
2019-07-15 15:34:10.937448: W tensorflow/core/framework/allocator.cc:107] Allocation of 89075712 exceeds 10% of system memory.
I0715 15:34:11.417682 140270154254080 session_manager.py:500] Running local_init_op.
I0715 15:34:11.480864 140270154254080 session_manager.py:502] Done running local_init_op.
I0715 15:34:52.634754 140270154254080 error_handling.py:96] prediction_loop marked as finished
I0715 15:34:52.634982 140270154254080 error_handling.py:96] prediction_loop marked as finished
processed 10368 tokens with 652 phrases; found: 670 phrases; correct: 483.
accuracy:  97.12%; precision:  72.09%; recall:  74.08%; FB1:  73.07
              LOC: precision:  92.71%; recall:  95.70%; FB1:  94.18  192
             MISC: precision:  63.44%; recall:  76.13%; FB1:  69.21  186
              ORG: precision:  70.63%; recall:  64.96%; FB1:  67.68  126
              PER: precision:  59.04%; recall:  56.32%; FB1:  57.65  166
yangnan@ncrs:/hdd1/yangnan/bertner$ 
